import { getCollection, type CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { languages } from "../../../i18n/ui";

export async function getStaticPaths() {
  const authors = await getCollection("authors");
  const paths = [];

  for (const lang of Object.keys(languages)) {
    for (const author of authors) {
      paths.push({
        params: { slug: author.id, lang },
        props: { author },
      });
    }
  }
  return paths;
}

interface Props {
  author: CollectionEntry<"authors">;
}

const { author } = Astro.props;
const { lang } = Astro.params;

const allPosts = await getCollection("blog");

const posts = allPosts.filter(
  (post) => post.data.author.id === author.id && post.slug.startsWith(`${lang}/`)
);

<BaseLayout title={author.data.name} description={author.data.bio}>
  <div class="author-header">
    <Image
      src={author.data.avatar}
      width={100}
      height={100}
      alt={author.data.name}
    />
    <h1>{author.data.name}</h1>
    <p>{author.data.bio}</p>
    <div class="social-links">
      {author.data.social?.twitter && (
        <a
          href={author.data.social.twitter}
          target="_blank"
          rel="noopener noreferrer"
        >
          Twitter
        </a>
      )}
      {author.data.social?.github && (
        <a
          href={author.data.social.github}
          target="_blank"
          rel="noopener noreferrer"
        >
          GitHub
        </a>
      )}
      {author.data.social?.website && (
        <a
          href={author.data.social.website}
          target="_blank"
          rel="noopener noreferrer"
        >
          Website
        </a>
      )}
    </div>
  </div>

  <h2>Posts by {author.data.name}</h2>
  <ul>
    {
      posts.map((post) => (
        <li>
          <a href={`/${post.slug}`}>{post.data.title}</a>
        </li>
      ))
    }
  </ul>
</BaseLayout>

<style>
  .author-header {
    text-align: center;
    padding: 2em 0;
  }
  .author-header img {
    border-radius: 50%;
    margin-bottom: 1em;
  }
  .social-links {
    display: flex;
    justify-content: center;
    gap: 1em;
    margin-top: 1em;
  }
  .social-links a {
    text-decoration: none;
    color: var(--accent);
  }
  .social-links a:hover {
    color: var(--accent-dark);
  }
  h2 {
    text-align: center;
    margin-top: 2em;
    margin-bottom: 1em;
  }
  ul {
    list-style-type: none;
    padding: 0;
    max-width: 720px;
    margin: auto;
  }
  li {
    margin-bottom: 0.5em;
    text-align: center;
  }
  li a {
    font-size: 1.25rem;
    text-decoration: none;
    color: var(--accent);
  }
  li a:hover {
    color: var(--accent-dark);
  }
</style>